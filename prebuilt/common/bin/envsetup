#!/system/bin/sh
# Additional environment setup

# Error fast
set -e

src="/data/data/com.pwnieexpress.android.pxinstaller/databases/"
dest="/data/data/com.cyanogenmod.trebuchet/databases/"
database="launcher.db"

# Check for launcher database generated by pxinstaller
if [ ! -f ${src}${database} ]; then
  printf "Unable to read launcher.db\n"
  exit 1
else 
  # Write the launcher database
  busybox cp ${src}${database} ${dest}  
fi

# Check corresponding journal file for permissions
if [ ! -f ${dest}${database}-journal ]; then
  printf "Unable to read launcher.db-journal\n"
  exit 1
else 
  # Fix permissions
  uid=`ls -l ${dest}${database}-journal |awk '{ print $2 }'`
  guid=`ls -l ${dest}${database}-journal |awk '{ print $3 }'`
  busybox chown ${uid}:${guid} ${dest}${database}
  busybox chmod 0660 ${dest}${database}
fi
